---
title: Songs
layout: empty
permalink: /songs/edit/
---

{% if page.url == "/songs/edit/" %}
<style>
    .pickr { 
        display: inline-block;
    }
</style>
<div class="flex flex-col m-2 px2-2 py-4 rounded-lg gap-y-2" lv-sr-box>
    <div>
        <label for="srTitle" class="block text-sm font-medium leading-6 text-gray-900">제목</label>
        <input type="text" name="srTitle" id="srTitle"
            class="block flex-1 w-full border-0 bg-transparent py-1.5 pl-1 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6" />
    </div>
    <div>
        <label for="srContent" class="block text-sm font-medium leading-6 text-gray-900">내용</label>
        <textarea id="srContent" name="srContent" rows="3"
            class="block w-full rounded-md border-0 px-1 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"></textarea>
    </div>
    <div class="border-2 bg-indigo-50 rounded p-2">
        <label class="block text-sm font-medium leading-6 text-gray-900">색상 설정</label>
        <label for="srColor" class="text-sm font-medium leading-6 text-gray-900">기본색(제목, 버튼색)</label>
        <input type="text" name="srColor"
            class="rounded border-0 bg-transparent py-1.5 pl-1 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6">
        <label for="srBgColor" class="text-sm font-medium leading-6 text-gray-900">배경색</label>
        <input type="text" name="srBgColor"
            class="rounded border-0 bg-transparent py-1.5 pl-1 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6">
    </div>
    <div class="border-2 bg-blue-50 rounded p-2">
        <label for="srToonKey" class="block text-sm font-medium leading-6 text-gray-900">투네이션 설정</label>
        <div
            class="flex w-full rounded-md my-2 shadow-sm ring-1 ring-inset ring-gray-300 focus-within:ring-2 focus-within:ring-inset focus-within:ring-indigo-600">
            <span
                class="flex select-none rounded bg-gray-200 items-center px-2 text-black-900 sm:text-sm">toon.at/widget/alertbox/</span>
            <input type="text" name="srToonKey" id="srToonKey"
                class="block flex-1 border-0 bg-transparent py-1.5 pl-1 text-gray-900 placeholder:text-gray-400 focus:ring-0 sm:text-sm sm:leading-6"
                placeholder="투네이션 알림 주소">
        </div>
        <label for="srToon" class="block text-sm font-medium leading-6 text-gray-900">후원 금액</label>
        <input type="number" name="srToon" id="srToon"
            class="block flex-1 w-full border-0 bg-transparent py-1.5 pl-1 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6" />
    </div>
    <div class="border-2 bg-yellow-50 rounded p-2">
        <div class="flex">
            <label class="text-sm font-medium leading-6 text-gray-900">치즈 설정</label>
            <label class="ml-2 relative inline-flex cursor-pointer items-center">
                <input id="srUseCheese" type="checkbox" class="peer sr-only" />
                <label for="srUseCheese" class="hidden"></label>
                <div
                    class="peer h-6 w-11 rounded-full border bg-slate-200 after:absolute after:left-[2px] after:top-0.5 after:h-5 after:w-5 after:rounded-full after:border after:border-gray-300 after:bg-white after:transition-all after:content-[''] peer-checked:bg-yellow-400 peer-checked:after:translate-x-full peer-checked:after:border-white peer-focus:ring-green-300">
                </div>
            </label>
        </div>
        <label for="srChzzk" class="block text-sm font-medium leading-6 text-gray-900">치즈 후원 금액</label>
        <input type="number" name="srChzzk" id="srChzzk"
            class="block flex-1 w-full border-0 bg-transparent py-1.5 pl-1 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6" />
    </div>

    <div class="flex mt-2 gap-x-2">
        <button type="button" id="btnSave"
            class="flex-1 rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">저장</button>

        <button type="button" id="btnCancel"
            class="flex-1 border-2 rounded-md bg-transparent font-semibold leading-6 text-gray-900">취소</button>
    </div>

    <div class="mt-4">
        <div class="flex">
            <label class="text-sm font-medium leading-6 text-gray-900">신청중 여부</label>
            <label class="ml-2 relative inline-flex cursor-pointer items-center">
                <input id="srUse" type="checkbox" class="peer sr-only" />
                <label for="srUse" class="hidden"></label>
                <div
                    class="peer h-6 w-11 rounded-full border bg-slate-200 after:absolute after:left-[2px] after:top-0.5 after:h-5 after:w-5 after:rounded-full after:border after:border-gray-300 after:bg-white after:transition-all after:content-[''] peer-checked:bg-yellow-400 peer-checked:after:translate-x-full peer-checked:after:border-white peer-focus:ring-green-300">
                </div>
            </label>
        </div>
        <label for="srDirect" class="text-sm font-medium leading-6 text-gray-900">신청곡 목록</label>
        <button id="srReset" class="btn btn-sm btn-outline-danger ml-2" type="button">초기화</button>
        <div class="mt-2 input-group">
            <input type="text" id="srDirect" name="srDirect"
                class="form-control rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"
                placeholder="직접추가">
            <div class="input-group-append">
                <button id="srAdd" class="btn btn-outline-primary" type="button">추가</button>
            </div>
        </div>
        <ul role="list" class="px-2 divide-y divide-gray-100" lv-sr-list></ul>
    </div>
</div>
{% endif %}

<script type="text/javascript">
    $(() => {
        const isUuid = !!location.search
        const uuid = isUuid ? location.search.substring(1) : crypto.randomUUID()
        if (!isUuid) {
            location.search = `?${uuid}`
        }


        const config = {
            data: {},
            picker: {},
            initPicker() {
                ['srColor', 'srBgColor'].forEach(r => {
                    if (!this.picker.hasOwnProperty(r)) {
                        this.picker[r] = Pickr.create({
                            el: document.querySelector(`[name=${r}]`),
                            container: 'body',
                            theme: 'nano',
                            default: this.data[r] || 'rgb(0, 0, 0)',
                            swatches: [
                                'rgba(244, 67, 54, 1)',
                                'rgba(233, 30, 99, 1)',
                                'rgba(156, 39, 176, 1)',
                                'rgba(103, 58, 183, 1)',
                                'rgba(63, 81, 181, 1)',
                                'rgba(33, 150, 243, 1)',
                                'rgba(3, 169, 244, 1)',
                                'rgba(0, 188, 212, 1)',
                                'rgba(0, 150, 136, 1)',
                                'rgba(76, 175, 80, 1)',
                                'rgba(139, 195, 74, 1)',
                                'rgba(205, 220, 57, 1)',
                                'rgba(255, 235, 59, 1)',
                                'rgba(255, 193, 7, 1)'
                            ],
                            components: {
                                palette: true,
                                preview: true,
                                opacity: true,
                                hue: true,
                                interaction: {
                                    input: true,
                                    cancel: true,
                                    save: true
                                }
                            },
                            interaction: {
                                rgba: true
                            },
                            i18n: {
                                // Strings visible in the UI
                                'ui:dialog': 'color picker dialog',
                                'btn:toggle': 'toggle color picker dialog',
                                'btn:swatch': 'color swatch',
                                'btn:last-color': 'use previous color',
                                'btn:save': 'Save',
                                'btn:cancel': 'Cancel',
                                'btn:clear': 'Clear',

                                // Strings used for aria-labels
                                'aria:btn:save': 'save and close',
                                'aria:btn:cancel': 'cancel and close',
                                'aria:btn:clear': 'clear and close',
                                'aria:input': 'color input field',
                                'aria:palette': 'color selection area',
                                'aria:hue': 'hue selection slider',
                                'aria:opacity': 'selection slider'
                            }
                        }).on('init', (color, instance) => {
                            document.querySelectorAll('.pcr-save').forEach((el) => { el.value = 'Save' })
                            document.querySelectorAll('.pcr-cancel').forEach((el) => { el.value = 'Cancel' })
                        }).on('save', (color, instance) => {
                            if (color) {
                                this.picker[r].hide()
                            }
                        }).on('cancel', instance => {
                            this.picker[r].hide()
                        })
                    }
                });
            },
            get() {
                this.data = JSON.parse(localStorage.getItem('SR_DATA')) || {
                    IS_CHEESE: false,
                    TITLE: '',
                    CONTENT: '',
                    TOON_KEY: '',
                    TOON: 1000,
                    CHEESE: 1000,
                    srBgColor: 'rgba(255, 255, 255, 0.7)',
                    srColor: 'rgb(0, 0, 0)'
                }
                this.render()
            },
            render() {
                this.initPicker()
                document.querySelector('#srUse').checked = localStorage.getItem('SR_USE') == undefined ? true : localStorage.getItem('SR_USE') == 'true'
                document.querySelector('#srTitle').value = this.data.TITLE
                document.querySelector('#srContent').value = this.data.CONTENT
                document.querySelector('#srToonKey').value = this.data.TOON_KEY
                document.querySelector('#srToon').value = this.data.TOON
                document.querySelector('#srUseCheese').checked = this.data.IS_CHEESE
                document.querySelector('#srChzzk').value = this.data.CHEESE
            },
            toggle() {
                this.data.CID = new Date().getTime()
                localStorage.setItem('SR_DATA', JSON.stringify(this.data))
                localStorage.setItem('SR_USE', document.querySelector('#srUse').checked)
                this.render()
            },
            save() {
                this.data.CID = new Date().getTime()
                this.data.TITLE = document.querySelector('#srTitle').value
                this.data.CONTENT = document.querySelector('#srContent').value
                this.data.TOON_KEY = document.querySelector('#srToonKey').value
                this.data.TOON = document.querySelector('#srToon').value
                this.data.IS_CHEESE = document.querySelector('#srUseCheese').checked
                this.data.CHEESE = document.querySelector('#srChzzk').value
                this.data.srColor = this.picker['srColor'].getColor().toRGBA().toString()
                this.data.srBgColor = this.picker['srBgColor'].getColor().toRGBA().toString()

                localStorage.setItem('SR_DATA', JSON.stringify(this.data))
                this.render()
                toast('저장되었습니다.')
            }
        }

        const list = {
            data: [],
            get() {
                this.data = JSON.parse(localStorage.getItem('SR_LIST')) || []
                this.render()
            },
            add() {
                const { value } = document.querySelector('#srDirect')
                if (value) {
                    this.data.push({ TITLE: value, IS_DONE: false })
                    localStorage.setItem('SR_LIST', JSON.stringify(this.data))
                    this.render()
                    document.querySelector('#srDirect').value = ''
                }
            },
            done(index) {
                this.data[index].IS_DONE = true
                localStorage.setItem('SR_LIST', JSON.stringify(this.data))
                this.render()
            },
            remove(index) {
                this.data.splice(index, 1)
                localStorage.setItem('SR_LIST', JSON.stringify(this.data))
                this.render()
            },
            clear() {
                localStorage.removeItem('SR_LIST')
                this.get()
            },
            render() {
                const srList = document.querySelector('[lv-sr-list]')

                srList.innerHTML = ''
                this.data.forEach((r, index) => {
                    const elItem = document.createElement('li')
                    elItem.className = 'flex justify-between gap-x-6 py-3'
                    elItem.innerHTML = `<div class="flex min-w-0 gap-x-4">
                        <div class="min-w-0 flex-auto">
                            <p class="text-base font-semibold leading-6 text-gray-900${r.IS_DONE ? ' line-through' : ''}">${r.TITLE}</p>
                        </div>
                        <div class="flex-3">
                            <button type="button" class="btn btn-sm btn-outline-success" lv-sr-submit=${index}>완료</button>
                            <button type="button" class="btn btn-sm btn-outline-danger" lv-sr-remove=${index}>삭제</button>
                        </div>
                    </div>`;
                    srList.appendChild(elItem)
                })
            }
        }

        config.get()
        list.get()

        /* 이벤트 리스너 시작 */
        document.querySelector('#btnSave').addEventListener('click', () => {
            config.save()
        })
        document.querySelector('#btnCancel').addEventListener('click', () => {
            config.get()
        })

        document.querySelector('#srUse').addEventListener('change', (e) => {
            console.log(e.target.checked, document.querySelector('#srUse').checked)
            config.toggle()
        })

        document.querySelector('[lv-sr-list]').addEventListener('click', (e) => {
            const el = e.target
            const { nodeName } = el
            if (nodeName == 'BUTTON') {
                if (el.hasAttribute('lv-sr-submit')) {
                    const index = el.getAttribute('lv-sr-submit')
                    list.done(index)
                }
                else if (el.hasAttribute('lv-sr-remove')) {
                    const index = el.getAttribute('lv-sr-remove')
                    list.remove(index)
                }
            }
        })

        const elReset = document.querySelector('#srReset')
        if (elReset) {
            const handleReset = (e) => {
                list.clear()
            }
            elReset.removeEventListener('click', handleReset)
            elReset.addEventListener('click', handleReset)
        }

        const elDirect = document.querySelector('#srDirect')
        if (elDirect) {
            const handleEnter = (e) => {
                if (e.which == 13) {
                    list.add()
                }
            }
            elDirect.removeEventListener('keyup', handleEnter)
            elDirect.addEventListener('keyup', handleEnter)
        }

        const elSrAdd = document.querySelector('#srAdd')
        if (elSrAdd) {
            elSrAdd.removeEventListener('click', list.add)
            elSrAdd.addEventListener('click', list.add)
        }
        /* 이벤트 리스너 끝*/
    })   
</script>